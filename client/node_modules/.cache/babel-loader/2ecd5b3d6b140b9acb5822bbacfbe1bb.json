{"ast":null,"code":"import axios from 'axios';\n//типизация всего стора\nimport { ModelUrls } from '../constants/url';\nimport { setErrorMessage, // тип экшенов authReducer\nsetAuth, // запись авторизации  в стейт\nsetIsAuth // типизация авторизации редюсера\n} from '../store/reducer/authReducer'; //типизация авторизация\n\n// авторизация\nexport const authorization = (value, history) => {\n  return async dispatch => {\n    try {\n      const {\n        data\n      } = await axios.post(ModelUrls.LOGIN, value);\n      console.log(data); //запись данных в sessionStorage\n\n      sessionStorage.setItem('token', data.token);\n      sessionStorage.setItem('email', data.email);\n      sessionStorage.setItem('role', data.role); //запись в стейт\n\n      dispatch(setAuth(data));\n      dispatch(setIsAuth(true));\n      history.push('/');\n    } catch (e) {\n      dispatch(setErrorMessage(e.message));\n    }\n  };\n}; //регистрация\n\nexport const registration = (value, history) => {\n  return async dispatch => {\n    try {\n      const {\n        data\n      } = await axios.post(ModelUrls.REGISTRATION, value);\n      const authorizationData = {\n        token: data.token,\n        email: data.user.email,\n        role: data.user.role\n      }; // console.log(authorizationData);\n\n      sessionStorage.setItem('token', data.token);\n      sessionStorage.setItem('username', data.user.email);\n      sessionStorage.setItem('role', data.role);\n      dispatch(setAuth(authorizationData));\n      dispatch(setIsAuth(true));\n      history.push('/');\n    } catch (e) {\n      console.log(e.message);\n      dispatch(setErrorMessage(e.message));\n    }\n  };\n};","map":{"version":3,"sources":["D:/Fullstack/online-store/client/src/action/authAction.ts"],"names":["axios","ModelUrls","setErrorMessage","setAuth","setIsAuth","authorization","value","history","dispatch","data","post","LOGIN","console","log","sessionStorage","setItem","token","email","role","push","e","message","registration","REGISTRATION","authorizationData","user"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEgD;AAChD,SAASC,SAAT,QAA0B,kBAA1B;AACA,SACEC,eADF,EAEiB;AACfC,OAHF,EAGW;AACTC,SAJF,CAKmB;AALnB,OAMO,8BANP,C,CAOA;;AAYA;AACA,OAAO,MAAMC,aAAa,GAAG,CAACC,KAAD,EAAkBC,OAAlB,KAA8C;AACzE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAMT,KAAK,CAACU,IAAN,CAAWT,SAAS,CAACU,KAArB,EAA4BL,KAA5B,CAAvB;AACAM,MAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ,EAFE,CAIF;;AACAK,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACO,KAArC;AACAF,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACQ,KAArC;AACAH,MAAAA,cAAc,CAACC,OAAf,CAAuB,MAAvB,EAA+BN,IAAI,CAACS,IAApC,EAPE,CAQF;;AACAV,MAAAA,QAAQ,CAACL,OAAO,CAACM,IAAD,CAAR,CAAR;AACAD,MAAAA,QAAQ,CAACJ,SAAS,CAAC,IAAD,CAAV,CAAR;AACAG,MAAAA,OAAO,CAACY,IAAR,CAAa,GAAb;AACD,KAZD,CAYE,OAAOC,CAAP,EAAe;AACfZ,MAAAA,QAAQ,CAACN,eAAe,CAACkB,CAAC,CAACC,OAAH,CAAhB,CAAR;AACD;AACF,GAhBD;AAiBD,CAlBM,C,CAmBP;;AACA,OAAO,MAAMC,YAAY,GAAG,CAAChB,KAAD,EAAkBC,OAAlB,KAA8C;AACxE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAMT,KAAK,CAACU,IAAN,CAAWT,SAAS,CAACsB,YAArB,EAAmCjB,KAAnC,CAAvB;AACA,YAAMkB,iBAAkC,GAAG;AACzCR,QAAAA,KAAK,EAAEP,IAAI,CAACO,KAD6B;AAEzCC,QAAAA,KAAK,EAAER,IAAI,CAACgB,IAAL,CAAUR,KAFwB;AAGzCC,QAAAA,IAAI,EAAET,IAAI,CAACgB,IAAL,CAAUP;AAHyB,OAA3C,CAFE,CAOF;;AACAJ,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACO,KAArC;AACAF,MAAAA,cAAc,CAACC,OAAf,CAAuB,UAAvB,EAAmCN,IAAI,CAACgB,IAAL,CAAUR,KAA7C;AACAH,MAAAA,cAAc,CAACC,OAAf,CAAuB,MAAvB,EAA+BN,IAAI,CAACS,IAApC;AACAV,MAAAA,QAAQ,CAACL,OAAO,CAACqB,iBAAD,CAAR,CAAR;AACAhB,MAAAA,QAAQ,CAACJ,SAAS,CAAC,IAAD,CAAV,CAAR;AACAG,MAAAA,OAAO,CAACY,IAAR,CAAa,GAAb;AACD,KAdD,CAcE,OAAOC,CAAP,EAAe;AACfR,MAAAA,OAAO,CAACC,GAAR,CAAYO,CAAC,CAACC,OAAd;AACAb,MAAAA,QAAQ,CAACN,eAAe,CAACkB,CAAC,CAACC,OAAH,CAAhB,CAAR;AACD;AACF,GAnBD;AAoBD,CArBM","sourcesContent":["import axios from 'axios';\r\nimport { ThunkAction } from 'redux-thunk'; // для типизации санки\r\nimport { RootStateType } from '../store/store'; //типизация всего стора\r\nimport { ModelUrls } from '../constants/url';\r\nimport {\r\n  setErrorMessage, // запись ошибки аторизации и регистрации в стейт\r\n  SetActionType, // тип экшенов authReducer\r\n  setAuth, // запись авторизации  в стейт\r\n  setIsAuth, //запись маркера авторизации\r\n  AuthReducerType, // типизация авторизации редюсера\r\n} from '../store/reducer/authReducer';\r\n//типизация авторизация\r\nexport type AuthType = {\r\n  email: string;\r\n  password: string;\r\n};\r\n// типизация санки\r\nexport type ThunkType = ThunkAction<\r\n  Promise<void>,\r\n  RootStateType,\r\n  unknown, //extraArgument\r\n  SetActionType\r\n>;\r\n// авторизация\r\nexport const authorization = (value: AuthType, history: any): ThunkType => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const { data } = await axios.post(ModelUrls.LOGIN, value);\r\n      console.log(data);\r\n\r\n      //запись данных в sessionStorage\r\n      sessionStorage.setItem('token', data.token);\r\n      sessionStorage.setItem('email', data.email);\r\n      sessionStorage.setItem('role', data.role);\r\n      //запись в стейт\r\n      dispatch(setAuth(data));\r\n      dispatch(setIsAuth(true));\r\n      history.push('/');\r\n    } catch (e: any) {\r\n      dispatch(setErrorMessage(e.message));\r\n    }\r\n  };\r\n};\r\n//регистрация\r\nexport const registration = (value: AuthType, history: any): ThunkType => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const { data } = await axios.post(ModelUrls.REGISTRATION, value);\r\n      const authorizationData: AuthReducerType = {\r\n        token: data.token,\r\n        email: data.user.email,\r\n        role: data.user.role,\r\n      };\r\n      // console.log(authorizationData);\r\n      sessionStorage.setItem('token', data.token);\r\n      sessionStorage.setItem('username', data.user.email);\r\n      sessionStorage.setItem('role', data.role);\r\n      dispatch(setAuth(authorizationData));\r\n      dispatch(setIsAuth(true));\r\n      history.push('/');\r\n    } catch (e: any) {\r\n      console.log(e.message);\r\n      dispatch(setErrorMessage(e.message));\r\n    }\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}