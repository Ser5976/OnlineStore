{"ast":null,"code":"import axios from 'axios';\n//типизация всего стора\nimport { ModelUrls } from '../constants/url';\nimport { setErrorMessage, // тип экшенов authReducer\nsetAuth // типизация авторизации редюсера\n} from '../store/reducer/authReducer'; //типизация авторизация\n\n// авторизация\nexport const authorization = (value, history) => {\n  return async dispatch => {\n    try {\n      const {\n        data\n      } = await axios.post(ModelUrls.LOGIN, value);\n      console.log(data); //запись данных в sessionStorage\n\n      sessionStorage.setItem('token', data.token);\n      sessionStorage.setItem('email', data.email); //запись в стейт\n\n      dispatch(setAuth(data));\n      history.push('/');\n    } catch (e) {\n      dispatch(setErrorMessage(e.message));\n    }\n  };\n}; //регистрация\n\nexport const registration = (value, history) => {\n  return async dispatch => {\n    try {\n      const {\n        data\n      } = await axios.post(ModelUrls.REGISTRATION, value);\n      const authorizationData = {\n        token: data.token,\n        email: data.user.email,\n        role: data.user.role\n      }; // console.log(authorizationData);\n\n      sessionStorage.setItem('token', data.token);\n      sessionStorage.setItem('username', data.user.email);\n      dispatch(setAuth(authorizationData));\n      history.push('/');\n    } catch (e) {\n      console.log(e.message);\n      dispatch(setErrorMessage(e.message));\n    }\n  };\n};","map":{"version":3,"sources":["D:/Fullstack/online-store/client/src/action/authAction.ts"],"names":["axios","ModelUrls","setErrorMessage","setAuth","authorization","value","history","dispatch","data","post","LOGIN","console","log","sessionStorage","setItem","token","email","push","e","message","registration","REGISTRATION","authorizationData","user","role"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEgD;AAChD,SAASC,SAAT,QAA0B,kBAA1B;AACA,SACEC,eADF,EAEiB;AACfC,OAHF,CAImB;AAJnB,OAKO,8BALP,C,CAMA;;AAYA;AACA,OAAO,MAAMC,aAAa,GAAG,CAACC,KAAD,EAAkBC,OAAlB,KAA8C;AACzE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAMR,KAAK,CAACS,IAAN,CAAWR,SAAS,CAACS,KAArB,EAA4BL,KAA5B,CAAvB;AACAM,MAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ,EAFE,CAIF;;AACAK,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACO,KAArC;AACAF,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACQ,KAArC,EANE,CAOF;;AACAT,MAAAA,QAAQ,CAACJ,OAAO,CAACK,IAAD,CAAR,CAAR;AACAF,MAAAA,OAAO,CAACW,IAAR,CAAa,GAAb;AACD,KAVD,CAUE,OAAOC,CAAP,EAAe;AACfX,MAAAA,QAAQ,CAACL,eAAe,CAACgB,CAAC,CAACC,OAAH,CAAhB,CAAR;AACD;AACF,GAdD;AAeD,CAhBM,C,CAiBP;;AACA,OAAO,MAAMC,YAAY,GAAG,CAACf,KAAD,EAAkBC,OAAlB,KAA8C;AACxE,SAAO,MAAOC,QAAP,IAAoB;AACzB,QAAI;AACF,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAMR,KAAK,CAACS,IAAN,CAAWR,SAAS,CAACoB,YAArB,EAAmChB,KAAnC,CAAvB;AACA,YAAMiB,iBAAkC,GAAG;AACzCP,QAAAA,KAAK,EAAEP,IAAI,CAACO,KAD6B;AAEzCC,QAAAA,KAAK,EAAER,IAAI,CAACe,IAAL,CAAUP,KAFwB;AAGzCQ,QAAAA,IAAI,EAAEhB,IAAI,CAACe,IAAL,CAAUC;AAHyB,OAA3C,CAFE,CAOF;;AACAX,MAAAA,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,IAAI,CAACO,KAArC;AACAF,MAAAA,cAAc,CAACC,OAAf,CAAuB,UAAvB,EAAmCN,IAAI,CAACe,IAAL,CAAUP,KAA7C;AACAT,MAAAA,QAAQ,CAACJ,OAAO,CAACmB,iBAAD,CAAR,CAAR;AACAhB,MAAAA,OAAO,CAACW,IAAR,CAAa,GAAb;AACD,KAZD,CAYE,OAAOC,CAAP,EAAe;AACfP,MAAAA,OAAO,CAACC,GAAR,CAAYM,CAAC,CAACC,OAAd;AACAZ,MAAAA,QAAQ,CAACL,eAAe,CAACgB,CAAC,CAACC,OAAH,CAAhB,CAAR;AACD;AACF,GAjBD;AAkBD,CAnBM","sourcesContent":["import axios from 'axios';\r\nimport { ThunkAction } from 'redux-thunk'; // для типизации санки\r\nimport { RootStateType } from '../store/store'; //типизация всего стора\r\nimport { ModelUrls } from '../constants/url';\r\nimport {\r\n  setErrorMessage, // запись ошибки аторизации и регистрации в стейт\r\n  SetActionType, // тип экшенов authReducer\r\n  setAuth, // запись авторизации  в стейт\r\n  AuthReducerType, // типизация авторизации редюсера\r\n} from '../store/reducer/authReducer';\r\n//типизация авторизация\r\nexport type AuthType = {\r\n  email: string;\r\n  password: string;\r\n};\r\n// типизация санки\r\nexport type ThunkType = ThunkAction<\r\n  Promise<void>,\r\n  RootStateType,\r\n  unknown, //extraArgument\r\n  SetActionType\r\n>;\r\n// авторизация\r\nexport const authorization = (value: AuthType, history: any): ThunkType => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const { data } = await axios.post(ModelUrls.LOGIN, value);\r\n      console.log(data);\r\n\r\n      //запись данных в sessionStorage\r\n      sessionStorage.setItem('token', data.token);\r\n      sessionStorage.setItem('email', data.email);\r\n      //запись в стейт\r\n      dispatch(setAuth(data));\r\n      history.push('/');\r\n    } catch (e: any) {\r\n      dispatch(setErrorMessage(e.message));\r\n    }\r\n  };\r\n};\r\n//регистрация\r\nexport const registration = (value: AuthType, history: any): ThunkType => {\r\n  return async (dispatch) => {\r\n    try {\r\n      const { data } = await axios.post(ModelUrls.REGISTRATION, value);\r\n      const authorizationData: AuthReducerType = {\r\n        token: data.token,\r\n        email: data.user.email,\r\n        role: data.user.role,\r\n      };\r\n      // console.log(authorizationData);\r\n      sessionStorage.setItem('token', data.token);\r\n      sessionStorage.setItem('username', data.user.email);\r\n      dispatch(setAuth(authorizationData));\r\n      history.push('/');\r\n    } catch (e: any) {\r\n      console.log(e.message);\r\n      dispatch(setErrorMessage(e.message));\r\n    }\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}